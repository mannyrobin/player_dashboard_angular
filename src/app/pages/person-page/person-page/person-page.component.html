<div *ngIf="person">
  <div class="row d-flex align-items-center">
    <div class="col-4">
      <div class="row d-flex align-items-center">
        <div class="col-5">
          <div class="text-center">
            <div class="img img-fluid avatar"
                 [ngStyle]="{'background-image': 'url('+ logo +')'}"></div>
            <br>
            <span class="btn-sm btn-file">
              {{'persons.person.changeAvatar' | translate}} <input type="file" (change)="onLogoChange($event)"
                                                                   accept="image/*">
            </span>
          </div>
        </div>
        <div class="col-5 fullname">
          <h3 class="first-name">{{person.firstName}}</h3>
          <h3 class="last-name">{{person.lastName}}</h3>
          <br>

          <p class="rate">{{'persons.person.rating' | translate}}: 72</p>
        </div>
      </div>
    </div>
    <div class="col-4">
      <div class="text-center">
        <img src="https://pp.userapi.com/c616320/v616320812/22445/UVDCNqgaspg.jpg" class="rounded-circle img-fluid"
             alt="User Image">
        <h3 class="m-0">ФК МОЛНИЯ</h3>
        <p class="m-0">U-14</p>
        <p class="m-0">ДЮФ</p>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-1">
      <p>{{'persons.person.roles.section' | translate}}</p>
    </div>
    <div class="col-10">
      <div class="btn-group" ngbRadioGroup name="radioBasic" [(ngModel)]="roleToggle" (change)="onRoleChange()">
        <label ngbButtonLabel class="btn-primary" *ngFor="let role of userRoles">
          <input ngbButton type="radio" [value]="role"> {{role.userRoleEnum}}
        </label>
      </div>
      <button class="btn btn-default btn-sm ml-3" (click)="toggleRolesModal()">
        <i class="fa fa-pencil-square-o"></i> <span> {{'persons.person.edit' | translate}}</span>
      </button>
    </div>
  </div>
  <div class="row">
    <div class="col-1">
      <p>{{'persons.person.sportTypes.section' | translate}}</p>
    </div>
    <div class="col-10">
      <div class="btn-group" ngbRadioGroup name="radioBasic" [(ngModel)]="sportTypeToggle"
           (change)="onSportTypeChange()">
        <label ngbButtonLabel class="btn-primary" *ngFor="let sportType of personSportTypes">
          <input ngbButton type="radio" [value]="sportType"> {{sportType.sportTypeEnum}}
        </label>
      </div>
      <button class="btn btn-default btn-sm ml-3" (click)="toggleSportTypesModal()">
        <i class="fa fa-pencil-square-o"></i> <span> {{'persons.person.edit' | translate}}</span>
      </button>
    </div>
  </div>
  <div class="mt-4">
    <ngb-tabset [destroyOnHide]="false">
      <ngb-tab title="{{'persons.person.personal.section' | translate | uppercase }}">
        <ng-template ngbTabContent>
          <div class="pt-3">
            <div class="row">
              <div class="col-3">
                <div class="form-group p-1">
                  <label for="lastName">{{'persons.person.personal.lastName' | translate}}</label>
                  <dx-text-box id="lastName" [(value)]="person.lastName">
                    <dx-validator>
                      <dxi-validation-rule type="required"></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-box>
                </div>
              </div>
              <div class="col-3">
                <div class="form-group p-1">
                  <label for="firstName">{{'persons.person.personal.firstName' | translate}}</label>
                  <dx-text-box id="firstName" [(value)]="person.firstName">
                    <dx-validator>
                      <dxi-validation-rule type="required"></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-box>
                </div>
              </div>
              <div class="col-3">
                <div class="form-group p-1">
                  <label for="middleName">{{'persons.person.personal.middleName' | translate}}</label>
                  <dx-text-box id="middleName" [(value)]="person.patronymic" [showClearButton]="true">
                  </dx-text-box>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-3">
                <div class="form-group p-1">
                  <label for="birthDate">{{'persons.person.personal.birthDate' | translate}}</label>
                  <dx-date-box id="birthDate" [(value)]="person.birthDate" type="date" class="w-100">
                    <dx-validator>
                      <dxi-validation-rule type="required"></dxi-validation-rule>
                    </dx-validator>
                  </dx-date-box>
                </div>
              </div>
              <div class="col-3">
                <div class="form-group p-1">
                  <label for="sex">{{'persons.person.personal.sex' | translate}}</label>
                  <dx-select-box id="sex" [items]="sexEnumValues" [(value)]="person.sex">
                    <dx-validator>
                      <dxi-validation-rule type="required"></dxi-validation-rule>
                    </dx-validator>
                  </dx-select-box>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-3" *ngIf="person.address.country">
                <label for="country">{{'persons.person.personal.country' | translate}}</label>
                <dx-select-box id="country" [dataSource]="countries" [(value)]="person.address.country.id"
                               (onValueChanged)="onCountryChange($event)"
                               valueExpr="id" displayExpr="name" [searchEnabled]="true"></dx-select-box>
              </div>
              <div class="col-3" *ngIf="person.address.region">
                <label for="region">{{'persons.person.personal.region' | translate}}</label>
                <dx-select-box id="region" [dataSource]="regions" [(value)]="person.address.region.id"
                               (onValueChanged)="onRegionChange($event)"
                               valueExpr="id" displayExpr="name" [searchEnabled]="true"></dx-select-box>
              </div>
              <div class="col-3" *ngIf="person.address.city">
                <label for="city">{{'persons.person.personal.city' | translate}}</label>
                <dx-select-box id="city" [dataSource]="cities" [(value)]="person.address.city.id"
                               valueExpr="id" displayExpr="name" [searchEnabled]="true"></dx-select-box>
              </div>
            </div>
          </div>
          <button type="button" class="btn btn-outline-success mt-3"
                  (click)="savePersonal()">{{'persons.person.save' | translate}}
          </button>
        </ng-template>
      </ngb-tab>
      <ngb-tab title="{{'persons.person.anthropometry.section' | translate | uppercase }}"
               *ngIf="roleToggle !== undefined && roleToggle.userRoleEnum.toString() !== 'TRAINER'">
        <ng-template ngbTabContent>
          <div class="pt-3">
            <div class="row" *ngFor="let pa of anthropometry">
              <div class="col-6">
                <div class="form-group p-1">
                  <label for="measure">{{pa.measureSpec.name}}</label>
                  <dx-text-box id="measure" [(value)]="pa.value" class="w-100">
                  </dx-text-box>
                </div>
              </div>
            </div>
            <button type="button" class="btn btn-outline-success mt-3"
                    (click)="saveAnthropometry()">{{'persons.person.save' | translate}}
            </button>
          </div>
        </ng-template>
      </ngb-tab>
      <ngb-tab title="{{'persons.person.physiology.section' | translate | uppercase }}"
               *ngIf="roleToggle !== undefined && roleToggle.userRoleEnum.toString() !== 'TRAINER'">
        <ng-template ngbTabContent></ng-template>
      </ngb-tab>
      <ngb-tab title="{{'persons.person.contact.section' | translate | uppercase }}">
        <ng-template ngbTabContent></ng-template>
      </ngb-tab>
      <ngb-tab title="{{'persons.person.testsResults.section' | translate | uppercase }}"
               *ngIf="roleToggle !== undefined && roleToggle.userRoleEnum.toString() !== 'TRAINER'">
        <ng-template ngbTabContent></ng-template>
      </ngb-tab>
      <ngb-tab title="{{'persons.person.events.section' | translate | uppercase }}"
               *ngIf="roleToggle !== undefined && roleToggle.userRoleEnum.toString() !== 'TRAINER'">
        <ng-template ngbTabContent>
        </ng-template>
      </ngb-tab>
    </ngb-tabset>
  </div>
  <dx-popup
    class="popup"
    [width]="600"
    [height]="500"
    [showTitle]="true"
    title="{{'persons.person.roles.section' | translate}}"
    [dragEnabled]="false"
    [closeOnOutsideClick]="true"
    [(visible)]="rolesModal">
    <div *dxTemplate="let data of 'content'" class="p-0">
      <div class="row h-100 ">
        <div class="col-6">
          <dx-list
            [items]="roles"
            [searchEnabled]="true"
            searchExpr="userRoleEnum"
            searchMode="contains">
            <div *dxTemplate="let data of 'item'">
              <div (dblclick)="addRole(data)" class="select-none">{{data.userRoleEnum}}</div>
            </div>
          </dx-list>
        </div>
        <div class="col-6 ">
          <div class="user-roles">
            <ul *ngFor="let role of userRolesModal">
              <li class="item">
                <button class="btn btn-primary btn-xs" (click)="removeRole(role)">
                  <i class="fa fa-times"></i><span>{{role.userRoleEnum}}</span>
                </button>
              </li>
            </ul>
            <button class="btn btn-sm" (click)="changeRoles()">Save</button>
          </div>
        </div>
      </div>
    </div>
  </dx-popup>
  <dx-popup
    class="popup"
    [width]="600"
    [height]="500"
    [showTitle]="true"
    title="{{'persons.person.sportTypes.edit' | translate}}"
    [dragEnabled]="false"
    [closeOnOutsideClick]="true"
    [(visible)]="sportTypesModal">
    <div *dxTemplate="let data of 'content'" class="p-0">
      <div class="row h-100 ">
        <div class="col-6">
          <dx-list
            [items]="sportTypes"
            [searchEnabled]="true"
            searchExpr="sportTypeEnum"
            searchMode="contains">
            <div *dxTemplate="let data of 'item'">
              <div (dblclick)="addSportType(data)" class="select-none">{{data.sportTypeEnum}}</div>
            </div>
          </dx-list>
        </div>
        <div class="col-6 ">
          <div class="user-roles">
            <ul *ngFor="let sportType of personSportTypesModal">
              <li class="item">
                <button class="btn btn-primary btn-xs" (click)="removeSportType(sportType)">
                  <i class="fa fa-times"></i><span>{{sportType.sportTypeEnum}}</span>
                </button>
              </li>
            </ul>
            <button class="btn btn-sm" (click)="changeSportTypes()">Save</button>
          </div>
        </div>
      </div>
    </div>
  </dx-popup>
</div>
