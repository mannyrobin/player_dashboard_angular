<div *ngIf="data"
     class="conversation-view {{class}}"
     fxFlex
     fxLayout="column">

  <mat-toolbar class="conversation-header">

    <div fxFlex fxLayout="row" fxLayoutAlign="space-between center">

      <div fxLayout="row" fxLayoutAlign="start center">

        <!-- RESPONSIVE CHATS BUTTON-->
        <button mat-icon-button
                fxHide.gt-md
                class="responsive-chats-button mr-16"
                aria-label="chats button"
                (click)="onToggleConversations()">
          <mat-icon>chat</mat-icon>
        </button>
        <!-- / RESPONSIVE CHATS BUTTON-->

        <!-- CHAT CONTACT-->
        <div class="chat-contact"
             fxLayout="row"
             fxLayoutAlign="start center"
             fuseMatSidenavToggler="chat-right-sidenav" *ngIf="recipient">
          <div *ngIf="data.discriminator !== baseConversationTypeClass.DIALOGUE || recipient.person"
               class="avatar-wrapper">
            <ngx-image #conversationLogo
                       class="avatar"
                       [object]="data.discriminator === baseConversationTypeClass.DIALOGUE ? recipient.person : data"
                       [type]="imageTypeClass.LOGO"
                       [fileClass]="data.discriminator === baseConversationTypeClass.DIALOGUE ? fileClass.PERSON : fileClass.CHAT"
                       [width]="40"
                       [height]="40"></ngx-image>
          </div>

          <div class="chat-contact-name">{{conversationName}}</div>

        </div>
        <!-- / CHAT CONTACT-->
      </div>

      <div>
        <button mat-icon-button [matMenuTriggerFor]="contactMenu" aria-label="more">
          <mat-icon>more_vert</mat-icon>
        </button>

        <mat-menu #contactMenu="matMenu">
          <button mat-menu-item
                  *ngIf="data.discriminator === baseConversationTypeClass.CHAT && person && data.owner.id == person.user.id"
                  (click)="editChat()">
            {{'settings' | translate}}
          </button>
          <button *ngIf="selectedMessages.size()"
                  mat-menu-item
                  (click)="deleteSelectedMessages()">
            {{'deleteSelectedMessages' | translate}}
          </button>
          <button mat-menu-item
                  (click)="toggleNotifications()">{{(enabled ? 'disableNotifications' : 'enableNotifications') |
            translate}}
          </button>
          <button mat-menu-item (click)="clearMessagesHistory()">{{'clearMessagesHistory' | translate}}
          </button>
          <button mat-menu-item (click)="quitChat()"
                  *ngIf="data.discriminator == 'CHAT' && person && data.owner.id != person.user.id">
            {{'quitChat' | translate}}
          </button>
        </mat-menu>
      </div>

    </div>
  </mat-toolbar>

  <div class="conversation-content"
       fxFlex="1 1 auto">
    <ngx-virtual-scroll [getItems]="getItems"
                        [autoScroll]="true">
      <ng-template let-message>
        <div (click)="toggleSelectMessage(message)"
             [ngClass]="{'selected': message.selected}">
          <app-message-item [message]="message"></app-message-item>
        </div>
      </ng-template>
    </ngx-virtual-scroll>
  </div>

  <div class="conversation-footer"
       fxFlex="0 0 auto"
       fxLayout="column">
    <emoji-mart *ngIf="visibleEmojiPicker"
                (emojiClick)="onAddEmoji($event)"
                set="emojione"></emoji-mart>

    <div class="reply-form"
         fxFlex="0 0 auto"
         fxLayout="row"
         fxLayoutAlign="center center">

      <form #replyForm="ngForm"
            (ngSubmit)="sendMessage()"
            (keydown.enter)="sendMessage()"
            fxFlex fxLayout="row"
            fxLayoutAlign="start center">
        <button class="attach-file-button"
                mat-icon-button
                type="button"
                (click)="onAttachFile()">
          <mat-icon class="secondary-text">attach_file</mat-icon>
        </button>

        <mat-form-field class="message-text" fxFlex floatLabel="never" appearance="standard">
          <textarea matInput placeholder="{{'writeMessage' | translate}}"
                    [(ngModel)]="messageContent.content" name="message" [rows]="1"
                    [matAutosizeMaxRows]="10"
                    [matTextareaAutosize]="true" (input)="onTyping()"></textarea>
        </mat-form-field>

        <button class="add-emoji-button"
                mat-icon-button
                type="button"
                (click)="onToggleEmojiPicker()">
          <mat-icon class="secondary-text">insert_emoticon</mat-icon>
        </button>
        <button class="send-message-button" mat-icon-button type="submit">
          <mat-icon class="secondary-text">send</mat-icon>
        </button>
      </form>
    </div>
  </div>
</div>
