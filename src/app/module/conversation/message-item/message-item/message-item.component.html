<div *ngIf="messageViewModel">

  <div [ngSwitch]="message.content.discriminator">

    <div *ngSwitchCase="baseMessageContentTypeClass.SYSTEM_MESSAGE_CONTENT"
         class="message-row system"
         [ngClass]="{'selected' : conversationService.selectedMessages.contains(message)}">
      <div class="bubble">
        <div class="message d-flex flex-column">
          <div *ngIf="messageViewModel.body"
               [innerHTML]="messageViewModel.body | urlParser | async"
               (click)="onDataClick($event)">
          </div>
          <div
            class="time secondary-text">{{message.content.created | date: propertyConstantClass.dateTimeFormat}}</div>
        </div>
      </div>
    </div>

    <div *ngSwitchCase="baseMessageContentTypeClass.MESSAGE_CONTENT"
         class="w-100">
      <ng-container [ngTemplateOutlet]="messageContent"></ng-container>
    </div>

    <div *ngSwitchCase="baseMessageContentTypeClass.EVENT_MESSAGE_CONTENT"
         class="w-100">
      <ng-container [ngTemplateOutlet]="messageContent"></ng-container>
    </div>

  </div>

</div>

<ng-template #messageContent>

  <div class="message-row" *ngIf="person"
       [ngClass]="{'me': message.sender.person.id === person.id,
       'contact': message.sender.person.id !== person.id,
           'selected' : conversationService.selectedMessages.contains(message)}">

    <img *ngIf="message.sender.person.id != person.id"
         src="http://localhost:8082/file/download/image?clazz=PERSON&objectId={{message.sender.person.id}}&type=LOGO"
         class="avatar">

    <div class="bubble">
      <div class="message d-flex flex-column">
        <p
          *ngIf="message.content.baseConversation.discriminator === baseConversationTypeClass.CHAT && message.sender.person.id !== person.id">
          {{message.sender.person.firstName}} {{message.sender.person.lastName}}</p>
        <pre [style.width]="'inherit'"
             [innerHTML]="messageViewModel.body | urlParser: {'previewImage': true}  | async"
             (click)="onDataClick($event)"></pre>
      </div>
      <div
        class="time secondary-text">{{updated ? (('edited' | translate | lowercase) + ' ' + (updated | date: propertyConstantClass.dateTimeFormat)) : (message.content.created | date: propertyConstantClass.dateTimeFormat)}}</div>
      <div *ngIf="message.sender.person.id == person.id">
        <i class="fa fa-check" *ngIf="(!message.read && !message.sender.person && !person && message.sender.person.id == person.id) || !message.read; else readMessage"></i>
        <ng-template #readMessage>
          <svg-icon src="/assets/img/check-double-solid.svg"
                    [svgStyle]="{'width.px': 14}"></svg-icon>
        </ng-template>
      </div>
    </div>

  </div>

</ng-template>
